<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Calculate the Bitcoin target price needed to reach your desired profit. Enter your BTC holdings, average buy price, and profit goal." />
    <meta name="theme-color" content="#f0e6d3" />
    <meta property="og:title" content="Bitcoin Profit Target Calculator" />
    <meta property="og:description" content="Calculate the Bitcoin target price needed to reach your desired profit. Enter your BTC holdings, average buy price, and profit goal." />
    <meta property="og:type" content="website" />
    <title>Bitcoin Profit Target Calculator</title>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap");

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        margin: 0 auto;
        padding: 40px 20px;
        background: #f0e6d3;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .container {
        background: #ffffff;
        border: 4px solid #000;
        border-radius: 0;
        padding: 40px;
        box-shadow: 8px 8px 0 #000;
        max-width: 600px;
        width: 100%;
        margin: 20px;
      }

      h1 {
        text-align: center;
        margin-bottom: 35px;
        color: #000;
        font-weight: 800;
        font-size: 28px;
        line-height: 1.3;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .input-group {
        margin-bottom: 25px;
      }

      label {
        font-weight: 700;
        display: block;
        margin-bottom: 8px;
        color: #000;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      input {
        width: 100%;
        padding: 14px 16px;
        margin-top: 6px;
        font-size: 16px;
        border: 3px solid #000;
        border-radius: 0;
        transition: all 0.15s ease;
        background: #fff;
        color: #000;
        font-weight: 600;
        box-shadow: 4px 4px 0 #000;
        -webkit-appearance: none;
        -webkit-tap-highlight-color: transparent;
      }

      input:focus {
        outline: none;
        background: #fff;
        box-shadow: 2px 2px 0 #000;
        transform: translate(2px, 2px);
      }

      input:focus-visible {
        outline: 3px solid #3b82f6;
        outline-offset: 2px;
      }

      input::placeholder {
        color: #666;
        opacity: 1;
        font-weight: 400;
      }

      .help-text {
        display: block;
        margin-top: 8px;
        font-size: 12px;
        color: #000;
        font-weight: 600;
        background: #fef08a;
        padding: 6px 10px;
        border: 2px solid #000;
      }

      .or-divider {
        text-align: center;
        color: #000;
        font-weight: 700;
        margin: 20px 0;
        position: relative;
        font-size: 14px;
        text-transform: uppercase;
        background: #a5f3fc;
        padding: 8px;
        border: 3px solid #000;
      }

      .or-divider::before,
      .or-divider::after {
        display: none;
      }

      button {
        width: 100%;
        margin-top: 30px;
        padding: 16px;
        font-size: 18px;
        font-weight: 700;
        background: #fef08a;
        color: #000;
        border: 4px solid #000;
        cursor: pointer;
        border-radius: 0;
        transition: all 0.15s ease;
        box-shadow: 6px 6px 0 #000;
        text-transform: uppercase;
        letter-spacing: 1px;
        will-change: transform;
        -webkit-tap-highlight-color: transparent;
      }

      button:hover {
        transform: translate(3px, 3px);
        box-shadow: 3px 3px 0 #000;
      }

      button:active {
        transform: translate(5px, 5px);
        box-shadow: 1px 1px 0 #000;
      }

      button:focus-visible {
        outline: 3px solid #3b82f6;
        outline-offset: 2px;
      }

      .spinner {
        display: inline-block;
        width: 18px;
        height: 18px;
        border: 3px solid #000;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        vertical-align: middle;
        margin-left: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .result {
        margin-top: 35px;
        padding: 25px;
        background: #d1fae5;
        border: 4px solid #000;
        border-radius: 0;
        font-size: 16px;
        line-height: 1.7;
        box-shadow: 6px 6px 0 #000;
        animation: popIn 0.3s ease;
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .highlight {
        font-size: 24px;
        font-weight: 800;
        color: #000;
        margin-bottom: 20px;
        display: block;
        text-align: center;
        padding: 15px;
        background: #fca5a5;
        border: 4px solid #000;
        border-radius: 0;
        box-shadow: 4px 4px 0 #000;
        text-transform: uppercase;
      }

      .result b {
        color: #000;
        font-weight: 700;
      }

      .result br {
        margin-bottom: 8px;
        display: block;
      }

      .error-output {
        margin-top: 20px;
        padding: 15px;
        background: #fca5a5;
        border: 4px solid #000;
        color: #000;
        font-weight: 700;
      }

      .footer {
        margin-top: 20px;
        text-align: center;
        font-size: 12px;
        color: #666;
        font-weight: 400;
        padding: 10px;
      }


      /* Live Price Section */
      .live-price-section {
        background: #e0e7ff;
        border: 3px solid #000;
        box-shadow: 4px 4px 0 #000;
        padding: 16px;
        margin-bottom: 25px;
        border-radius: 0;
      }

      .live-price-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .live-indicator {
        width: 10px;
        height: 10px;
        background: #22c55e;
        border: 2px solid #000;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .live-label {
        font-weight: 700;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .refresh-btn {
        margin-left: auto;
        background: #fef08a;
        border: 2px solid #000;
        padding: 4px 10px;
        cursor: pointer;
        font-weight: 700;
        font-size: 14px;
        box-shadow: 2px 2px 0 #000;
        transition: all 0.15s ease;
      }

      .refresh-btn:hover {
        transform: translate(1px, 1px);
        box-shadow: 1px 1px 0 #000;
      }

      .live-price-value {
        font-size: 28px;
        font-weight: 800;
        color: #000;
        margin: 8px 0;
      }

      .last-updated {
        font-size: 11px;
        color: #666;
        font-weight: 600;
      }

      /* Price Error */
      .price-error {
        background: #fca5a5;
        border: 3px solid #000;
        box-shadow: 4px 4px 0 #000;
        padding: 12px;
        margin-bottom: 25px;
        display: none;
        align-items: center;
        gap: 8px;
        border-radius: 0;
      }

      .price-error .retry-btn {
        margin-left: auto;
        background: #fef08a;
        border: 2px solid #000;
        padding: 6px 12px;
        cursor: pointer;
        font-weight: 700;
        font-size: 12px;
        box-shadow: 2px 2px 0 #000;
      }

      /* Price Comparison */
      .price-comparison {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 3px dashed #000;
      }

      .comparison-header {
        font-weight: 700;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 15px;
        text-align: center;
        background: #a5f3fc;
        padding: 8px;
        border: 2px solid #000;
      }

      .comparison-grid {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .comparison-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #fff;
        border: 2px solid #000;
      }

      .comparison-label {
        font-weight: 600;
        font-size: 13px;
      }

      .comparison-value {
        font-weight: 800;
        font-size: 14px;
      }

      .highlight-row {
        background: #d1fae5;
      }

      .highlight-row.warning {
        background: #fca5a5;
      }

      .comparison-indicator {
        margin-top: 15px;
        padding: 12px;
        text-align: center;
        font-weight: 700;
        font-size: 14px;
        border: 3px solid #000;
        box-shadow: 4px 4px 0 #000;
      }

      .comparison-indicator.success {
        background: #d1fae5;
      }

      .comparison-indicator.warning {
        background: #fca5a5;
      }

      @media (max-width: 640px) {
        .container {
          padding: 25px 20px;
          box-shadow: 6px 6px 0 #000;
          margin: 16px;
        }

        h1 {
          font-size: 22px;
          margin-bottom: 25px;
        }

        .highlight {
          font-size: 18px;
          padding: 12px;
        }

        button {
          box-shadow: 4px 4px 0 #000;
        }

        button:hover {
          transform: translate(2px, 2px);
          box-shadow: 2px 2px 0 #000;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 16px 14px;
          margin: 16px;
        }

        h1 {
          font-size: 18px;
        }

        label {
          font-size: 12px;
        }

        input {
          padding: 12px;
          box-shadow: 3px 3px 0 #000;
        }

        input:focus {
          box-shadow: 1px 1px 0 #000;
          transform: translate(2px, 2px);
        }

        button {
          padding: 14px;
          box-shadow: 3px 3px 0 #000;
        }

        button:hover {
          transform: translate(1px, 1px);
          box-shadow: 2px 2px 0 #000;
        }

        .highlight {
          font-size: 16px;
          padding: 10px;
          box-shadow: 3px 3px 0 #000;
        }

        .result {
          box-shadow: 3px 3px 0 #000;
        }
      }

      @media (max-width: 360px) {
        body {
          padding: 20px 8px;
        }

        .container {
          padding: 14px 12px;
          margin: 8px;
          box-shadow: 4px 4px 0 #000;
        }

        h1 {
          font-size: 16px;
          margin-bottom: 20px;
        }

        label {
          font-size: 11px;
        }

        input {
          padding: 10px;
          font-size: 16px;
        }

        button {
          padding: 12px;
          font-size: 16px;
        }

        .highlight {
          font-size: 14px;
        }
      }

      /* ─── THEME PICKER ─────────────────────────────────── */

      .theme-picker {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
      }

      .theme-btn {
        width: auto;
        margin-top: 0;
        padding: 8px 14px;
        font-size: 12px;
        font-weight: 700;
        border: 3px solid #000;
        cursor: pointer;
        border-radius: 0;
        transition: all 0.15s ease;
        box-shadow: 4px 4px 0 #000;
        text-transform: uppercase;
        letter-spacing: 1px;
        will-change: transform;
        -webkit-tap-highlight-color: transparent;
        background: #fff;
        color: #000;
      }

      .theme-btn:hover {
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0 #000;
      }

      .theme-btn:active {
        transform: translate(3px, 3px);
        box-shadow: 1px 1px 0 #000;
      }

      .theme-btn:focus-visible {
        outline: 3px solid #3b82f6;
        outline-offset: 2px;
      }

      .theme-btn.active {
        transform: translate(3px, 3px);
        box-shadow: 1px 1px 0 #000;
      }

      .theme-btn-default { background: #f0e6d3; }
      .theme-btn-dark    { background: #1a1a1a; color: #ccff00; }
      .theme-btn-pink    { background: #f48fb1; }

      /* ─── DARK THEME ───────────────────────────────────── */

      body.theme-dark {
        background: #1a1a1a;
      }

      body.theme-dark .container {
        background: #2a2a2a;
        border-color: #000;
        box-shadow: 8px 8px 0 #000;
      }

      body.theme-dark h1 {
        color: #ccff00;
      }

      body.theme-dark label {
        color: #e0e0e0;
      }

      body.theme-dark input {
        background: #1a1a1a;
        color: #e0e0e0;
        border-color: #000;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-dark input:focus {
        background: #1a1a1a;
        box-shadow: 2px 2px 0 #000;
      }

      body.theme-dark input:focus-visible {
        outline-color: #ccff00;
      }

      body.theme-dark input::placeholder {
        color: #888;
      }

      body.theme-dark .help-text {
        background: #333;
        color: #ccff00;
        border-color: #000;
      }

      body.theme-dark .or-divider {
        background: #00d4e8;
        color: #000;
        border-color: #000;
      }

      body.theme-dark button {
        background: #ccff00;
        color: #000;
        border-color: #000;
        box-shadow: 6px 6px 0 #000;
      }

      body.theme-dark button:hover {
        box-shadow: 3px 3px 0 #000;
      }

      body.theme-dark button:active {
        box-shadow: 1px 1px 0 #000;
      }

      body.theme-dark button:focus-visible {
        outline-color: #ccff00;
      }

      body.theme-dark .result {
        background: #1a3a2a;
        border-color: #000;
        box-shadow: 6px 6px 0 #000;
        color: #e0e0e0;
      }

      body.theme-dark .result b {
        color: #ccff00;
      }

      body.theme-dark .highlight {
        background: #ff6b6b;
        color: #000;
        border-color: #000;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-dark .error-output {
        background: #5a1a1a;
        border-color: #000;
        color: #ff6b6b;
      }

      body.theme-dark .footer {
        color: #888;
      }

      body.theme-dark .theme-btn {
        border-color: #000;
        color: #ccff00;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-dark .theme-btn:hover {
        box-shadow: 2px 2px 0 #000;
      }

      body.theme-dark .theme-btn:active,
      body.theme-dark .theme-btn.active {
        box-shadow: 1px 1px 0 #000;
      }

      body.theme-dark .theme-btn-default { background: #f0e6d3; color: #000; }
      body.theme-dark .theme-btn-dark    { background: #1a1a1a; color: #ccff00; }
      body.theme-dark .theme-btn-pink    { background: #f48fb1; color: #000; }

      body.theme-dark .spinner {
        border-color: #000;
        border-top-color: transparent;
      }

      /* ─── PINK THEME ───────────────────────────────────── */

      body.theme-pink {
        background: #fce4ec;
      }

      body.theme-pink .container {
        background: #fff0f5;
        border-color: #000;
        box-shadow: 8px 8px 0 #000;
      }

      body.theme-pink h1 {
        color: #ad1457;
      }

      body.theme-pink label {
        color: #880e4f;
      }

      body.theme-pink input {
        background: #fff;
        color: #880e4f;
        border-color: #000;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-pink input:focus {
        background: #fff;
        box-shadow: 2px 2px 0 #000;
      }

      body.theme-pink input:focus-visible {
        outline-color: #ad1457;
      }

      body.theme-pink input::placeholder {
        color: #f48fb1;
      }

      body.theme-pink .help-text {
        background: #fce4ec;
        color: #ad1457;
        border-color: #000;
      }

      body.theme-pink .or-divider {
        background: #e1bee7;
        color: #6a1b9a;
        border-color: #000;
      }

      body.theme-pink button {
        background: #f48fb1;
        color: #000;
        border-color: #000;
        box-shadow: 6px 6px 0 #000;
      }

      body.theme-pink button:hover {
        box-shadow: 3px 3px 0 #000;
      }

      body.theme-pink button:active {
        box-shadow: 1px 1px 0 #000;
      }

      body.theme-pink button:focus-visible {
        outline-color: #ad1457;
      }

      body.theme-pink .result {
        background: #f8bbd0;
        border-color: #000;
        box-shadow: 6px 6px 0 #000;
        color: #880e4f;
      }

      body.theme-pink .result b {
        color: #ad1457;
      }

      body.theme-pink .highlight {
        background: #e91e8c;
        color: #fff;
        border-color: #000;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-pink .error-output {
        background: #fce4ec;
        border-color: #000;
        color: #ad1457;
      }

      body.theme-pink .footer {
        color: #f48fb1;
      }

      body.theme-pink .theme-btn {
        border-color: #000;
        box-shadow: 4px 4px 0 #000;
      }

      body.theme-pink .theme-btn:hover {
        box-shadow: 2px 2px 0 #000;
      }

      body.theme-pink .theme-btn:active,
      body.theme-pink .theme-btn.active {
        box-shadow: 1px 1px 0 #000;
      }

      body.theme-pink .theme-btn-default { background: #f0e6d3; color: #000; }
      body.theme-pink .theme-btn-dark    { background: #1a1a1a; color: #f48fb1; }
      body.theme-pink .theme-btn-pink    { background: #f48fb1; color: #000; }

      @media (max-width: 480px) {
        .theme-picker {
          gap: 6px;
        }

        .theme-btn {
          padding: 6px 10px;
          font-size: 11px;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <div class="theme-picker" role="group" aria-label="Choose theme">
        <button class="theme-btn theme-btn-default active" type="button" onclick="setTheme('default')" aria-label="Default theme" aria-pressed="true" id="themeDefault">Default</button>
        <button class="theme-btn theme-btn-dark" type="button" onclick="setTheme('dark')" aria-label="Dark theme" aria-pressed="false" id="themeDark">Dark</button>
        <button class="theme-btn theme-btn-pink" type="button" onclick="setTheme('pink')" aria-label="Pink theme" aria-pressed="false" id="themePink">Pink</button>
      </div>
    </header>
    <main>
      <div class="container">
        <h1>Bitcoin Target Price &amp; Profit Calculator</h1>

        <div id="livePriceSection" class="live-price-section" aria-live="polite">
          <div class="live-price-header">
            <span class="live-indicator"></span>
            <span class="live-label">LIVE BTC PRICE</span>
            <button id="refreshPriceBtn" class="refresh-btn" onclick="fetchLivePrice()" aria-label="Refresh BTC price">
              ↻
            </button>
          </div>
          <div class="live-price-value" id="livePrice">Loading...</div>
          <div class="last-updated" id="lastUpdated"></div>
        </div>

        <div id="priceError" class="price-error">
          <span class="error-icon">⚠️</span>
          <span class="error-message" id="priceErrorMessage">Unable to fetch live price</span>
          <button class="retry-btn" onclick="fetchLivePrice()">Retry</button>
        </div>

        <div class="input-group">
          <label for="btcOwned">Total Bitcoins Owned (BTC):</label>
          <input
            type="number"
            id="btcOwned"
            placeholder="Example: 1.5"
            step="0.0001"
            min="0"
            max="1000000"
            pattern="^\d+(\.\d{1,6})?$"
            required
            aria-describedby="btcOwnedHelp"
            aria-required="true"
            aria-invalid="false"
            aria-live="polite"
            onkeydown="handleKeydown(event)"
          />
          <small id="btcOwnedHelp" class="help-text">Enter the amount of BTC you own (up to 6 decimal places)</small>
        </div>

        <div class="input-group">
          <label for="avgPrice">Average Buy Price per BTC ($):</label>
          <input
            type="number"
            id="avgPrice"
            placeholder="Example: 80000"
            step="0.01"
            min="1"
            max="1000000"
            pattern="^\d+(\.\d{1,2})?$"
            required
            aria-describedby="avgPriceHelp"
            aria-required="true"
            aria-invalid="false"
            aria-live="polite"
            onkeydown="handleKeydown(event)"
          />
          <small id="avgPriceHelp" class="help-text">Enter the average price you paid per BTC</small>
        </div>

        <div class="input-group">
          <label for="profitUSD">Desired Profit ($):</label>
          <input
            type="number"
            id="profitUSD"
            placeholder="Example: 20000"
            step="0.01"
            min="0"
            max="1000000"
            pattern="^\d+(\.\d{1,2})?$"
            aria-describedby="profitUSDHelp"
            aria-invalid="false"
            aria-live="polite"
            onkeydown="handleKeydown(event)"
            oninput="clearField('profitPercent')"
          />
          <small id="profitUSDHelp" class="help-text">Enter profit amount in USD (leave blank if using percentage)</small>
        </div>

        <div class="or-divider" aria-hidden="true">OR</div>

        <div class="input-group">
          <label for="profitPercent">Desired Profit (%):</label>
          <input
            type="number"
            id="profitPercent"
            placeholder="Example: 25"
            step="0.01"
            min="0"
            max="1000"
            pattern="^\d+(\.\d{1,2})?$"
            aria-describedby="profitPercentHelp"
            aria-invalid="false"
            aria-live="polite"
            onkeydown="handleKeydown(event)"
            oninput="clearField('profitUSD')"
          />
          <small id="profitPercentHelp" class="help-text">Enter profit percentage (leave blank if using USD amount)</small>
        </div>

        <div class="input-group">
          <button id="calculateBtn" type="button" onclick="calculate()" aria-label="Calculate target BTC price">
            <span id="btnText">Calculate Target Price</span>
            <span id="btnSpinner" class="spinner" style="display: none;"></span>
          </button>
        </div>

        <div class="result" id="output" aria-live="polite" style="display: none;"></div>

        <div id="errorOutput" class="error-output" aria-live="polite" role="alert" style="display: none;"></div>
      </div>
    </main>

    <footer class="footer">For educational purposes only. Not financial advice.</footer>

    <script>
      // Global state for live price
      var appState = {
        livePrice: null,
        lastUpdated: null,
        isLoading: false,
        error: null,
        refreshInterval: null
      };

      // Fetch live BTC price from CoinGecko API
      function fetchLivePrice() {
        if (appState.isLoading) return;
        
        appState.isLoading = true;
        
        // Show loading state
        var livePriceEl = document.getElementById('livePrice');
        var refreshBtn = document.getElementById('refreshPriceBtn');
        livePriceEl.textContent = 'Loading...';
        refreshBtn.disabled = true;
        
        fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd')
          .then(function(response) {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(function(data) {
            if (data.bitcoin && data.bitcoin.usd) {
              updateLivePriceDisplay(data.bitcoin.usd);
              appState.error = null;
            } else {
              throw new Error('Invalid data format');
            }
          })
          .catch(function(error) {
            console.error('Error fetching BTC price:', error);
            showPriceError('Price temporarily unavailable');
          })
          .finally(function() {
            appState.isLoading = false;
            refreshBtn.disabled = false;
          });
      }

      // Update DOM with live price
      function updateLivePriceDisplay(price) {
        var livePriceEl = document.getElementById('livePrice');
        var lastUpdatedEl = document.getElementById('lastUpdated');
        var priceErrorEl = document.getElementById('priceError');
        var livePriceSection = document.getElementById('livePriceSection');
        
        appState.livePrice = price;
        appState.lastUpdated = new Date();
        
        // Hide error, show price section
        priceErrorEl.style.display = 'none';
        livePriceSection.style.display = 'block';
        
        // Update price
        livePriceEl.textContent = '$' + formatUSD(price);
        lastUpdatedEl.textContent = 'Last updated: ' + formatTimestamp(appState.lastUpdated);
        
        // If results are visible, update comparison
        var output = document.getElementById('output');
        if (output.style.display !== 'none' && output.innerHTML.indexOf('price-comparison') !== -1) {
          calculate();
        }
      }

      // Show price error
      function showPriceError(message) {
        var priceErrorEl = document.getElementById('priceError');
        var priceErrorMessage = document.getElementById('priceErrorMessage');
        var livePriceSection = document.getElementById('livePriceSection');
        
        priceErrorMessage.textContent = message;
        priceErrorEl.style.display = 'flex';
        livePriceSection.style.display = 'none';
        appState.error = message;
      }

      // Format timestamp
      function formatTimestamp(date) {
        return date.toLocaleTimeString('en-US', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
      }

      // Start auto-refresh
      function startAutoRefresh() {
        if (appState.refreshInterval) {
          clearInterval(appState.refreshInterval);
        }
        appState.refreshInterval = setInterval(fetchLivePrice, 60000); // 60 seconds
      }

      // Stop auto-refresh
      function stopAutoRefresh() {
        if (appState.refreshInterval) {
          clearInterval(appState.refreshInterval);
          appState.refreshInterval = null;
        }
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        fetchLivePrice();
        startAutoRefresh();
      });

      function formatUSD(value) {
        return value.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function clearField(fieldId) {
        document.getElementById(fieldId).value = "";
      }

      function handleKeydown(event) {
        if (event.key === "Enter") {
          calculate();
        }
      }

      function showError(message) {
        var output = document.getElementById("output");
        var errorOutput = document.getElementById("errorOutput");
        output.style.display = "none";
        output.innerHTML = "";
        errorOutput.style.display = "block";
        errorOutput.innerHTML = message;
      }

      function showResult(html) {
        var output = document.getElementById("output");
        var errorOutput = document.getElementById("errorOutput");
        errorOutput.style.display = "none";
        errorOutput.innerHTML = "";
        output.style.display = "block";
        output.innerHTML = html;
      }

      function setTheme(theme) {
        var body = document.body;
        body.classList.remove("theme-dark", "theme-pink");
        if (theme === "dark") {
          body.classList.add("theme-dark");
        } else if (theme === "pink") {
          body.classList.add("theme-pink");
        }
        var btns = ["themeDefault", "themeDark", "themePink"];
        var themes = ["default", "dark", "pink"];
        for (var i = 0; i < btns.length; i++) {
          var btn = document.getElementById(btns[i]);
          var isActive = themes[i] === theme;
          if (isActive) {
            btn.classList.add("active");
            btn.setAttribute("aria-pressed", "true");
          } else {
            btn.classList.remove("active");
            btn.setAttribute("aria-pressed", "false");
          }
        }
        try { localStorage.setItem("btc-theme", theme); } catch(e) {}
      }

      function initTheme() {
        var saved;
        try { saved = localStorage.getItem("btc-theme"); } catch(e) {}
        setTheme(saved || "default");
      }

      initTheme();

      function calculate() {
        var btcOwned = parseFloat(document.getElementById("btcOwned").value);
        var avgPrice = parseFloat(document.getElementById("avgPrice").value);
        var profitUSD = parseFloat(document.getElementById("profitUSD").value);
        var profitPercent = parseFloat(document.getElementById("profitPercent").value);

        if (isNaN(btcOwned) || btcOwned <= 0) {
          showError("\u26a0\ufe0f Please enter a valid BTC amount greater than zero.");
          return;
        }

        if (isNaN(avgPrice) || avgPrice <= 0) {
          showError("\u26a0\ufe0f Please enter a valid average buy price greater than zero.");
          return;
        }

        var totalCost = btcOwned * avgPrice;
        var breakEvenPrice = avgPrice;
        var desiredProfitValue = 0;

        if (!isNaN(profitUSD) && profitUSD > 0) {
          desiredProfitValue = profitUSD;
        } else if (!isNaN(profitPercent) && profitPercent > 0) {
          desiredProfitValue = totalCost * (profitPercent / 100);
        } else {
          showError("\u26a0\ufe0f Please enter either profit in USD or profit percentage.");
          return;
        }

        var targetSellValue = totalCost + desiredProfitValue;
        var targetBTCPrice = targetSellValue / btcOwned;
        var achievedPercent = (desiredProfitValue / totalCost) * 100;

        var resultHTML =
          '<div class="highlight">' +
            "\u2705 Target BTC Price Needed: $" + formatUSD(targetBTCPrice) +
          "</div>" +
          "<br>" +
          "<b>Total BTC Owned:</b> " + btcOwned + " BTC <br>" +
          "<b>Average Buy Price:</b> $" + formatUSD(avgPrice) + " <br>" +
          "<b>Break-even BTC Price:</b> $" + formatUSD(breakEvenPrice) + " <br><br>" +
          "<b>Total Investment Cost:</b> $" + formatUSD(totalCost) + " <br>" +
          "<b>Desired Profit:</b> $" + formatUSD(desiredProfitValue) + " <br>" +
          "<b>Profit Percentage:</b> " + achievedPercent.toFixed(2) + "% <br><br>" +
          "<b>Total Sell Value Needed:</b> $" + formatUSD(targetSellValue);

        if (appState.livePrice !== null) {
          var currentPrice = appState.livePrice;
          var priceDifference = targetBTCPrice - currentPrice;
          var differencePercent = ((targetBTCPrice - currentPrice) / currentPrice) * 100;
          var isTargetReachable = currentPrice >= targetBTCPrice;

          var differenceText = "";
          if (priceDifference > 0) {
            differenceText = "+" + differencePercent.toFixed(2) + "% above current price";
          } else if (priceDifference < 0) {
            differenceText = Math.abs(differencePercent).toFixed(2) + "% below current price";
          } else {
            differenceText = "Matches current price exactly";
          }

          var indicatorClass = isTargetReachable ? "success" : "warning";
          var indicatorText = isTargetReachable
            ? "\u2705 Target is REACHABLE! Current price meets your goal."
            : "\u26a0\ufe0f Target is ABOVE current price. BTC needs to rise.";

          var highlightRowClass = isTargetReachable ? "highlight-row" : "highlight-row warning";

          resultHTML +=
            '<div class="price-comparison">' +
              '<div class="comparison-header">PRICE COMPARISON</div>' +
              '<div class="comparison-grid">' +
                '<div class="comparison-item">' +
                  '<span class="comparison-label">Current BTC Price:</span>' +
                  '<span class="comparison-value">$' + formatUSD(currentPrice) + '</span>' +
                '</div>' +
                '<div class="comparison-item">' +
                  '<span class="comparison-label">Your Target Price:</span>' +
                  '<span class="comparison-value">$' + formatUSD(targetBTCPrice) + '</span>' +
                '</div>' +
                '<div class="comparison-item ' + highlightRowClass + '">' +
                  '<span class="comparison-label">Difference:</span>' +
                  '<span class="comparison-value">' + differenceText + '</span>' +
                '</div>' +
              '</div>' +
              '<div class="comparison-indicator ' + indicatorClass + '">' +
                indicatorText +
              '</div>' +
            '</div>';
        }

        showResult(resultHTML);
      }
    </script>
  </body>
</html>
